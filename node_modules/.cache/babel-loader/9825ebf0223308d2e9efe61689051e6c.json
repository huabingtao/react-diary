{"ast":null,"code":"var _jsxFileName = \"/Users/hbt/MyProject/gitHub/react-diary/src/views/index.jsx\";\nimport React from 'react';\nimport { Tabs, PullToRefresh, Toast } from 'antd-mobile';\nimport axios from '../utils/request';\nimport Header from '../components/Header';\nimport RList from '../components/List';\nimport AddButton from '../components/AddButton';\nimport NoData from '../components/NoData';\nimport '../styles/register.css';\n\nclass Index extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      allDiarys: [],\n      myDiarys: [],\n      visible: true,\n      selected: '',\n      tabIndex: 0\n    };\n  }\n\n  componentDidMount() {\n    this._getAllDiarys();\n  }\n\n  onClickButton() {\n    this.props.history.push('/writeDiary');\n  }\n\n  async _getMyDiarys() {\n    const user = JSON.parse(window.localStorage.getItem('user'));\n\n    if (!user) {\n      this.setState({\n        refreshing: false\n      });\n      return;\n    }\n\n    const res = await axios.get('diary/myDiary', {\n      params: {\n        id: user.id,\n        start: 0,\n        count: 10\n      }\n    });\n    this.setState({\n      myDiarys: res.data,\n      refreshing: false\n    });\n  }\n\n  onClickDiary(item) {\n    this.props.history.push(`diaryDetail/${item.id}`);\n  }\n\n  onClickFavor(item, e) {\n    e.stopPropagation();\n    const {\n      id,\n      uid\n    } = item;\n\n    this._favor(id, uid);\n  }\n\n  onTabClick(tab, index) {\n    if (!this.isDidMyDiary && index === 1) {\n      this._getMyDiarys();\n\n      this.isDidMyDiary = true;\n    }\n\n    this.setState({\n      tabIndex: index\n    });\n  }\n\n  onTabRight() {\n    const storage = window.localStorage;\n    storage.removeItem('user');\n    this.props.history.push('/login');\n  }\n\n  async _favor(diary_id, uid) {\n    await axios.post('/favor/', {\n      diary_id,\n      uid\n    });\n    const {\n      allDiarys,\n      myDiarys,\n      tabIndex\n    } = this.state;\n\n    if (tabIndex === 0) {\n      allDiarys.map(diary => {\n        if (diary.id === diary_id) {\n          diary.isFavor = 1;\n          diary.favor_nums = diary.favor_nums + 1;\n        }\n      });\n    } else {\n      myDiarys.map(diary => {\n        if (diary.id === diary_id) {\n          diary.isFavor = 1;\n          diary.favor_nums = diary.favor_nums + 1;\n        }\n      });\n    }\n\n    this.setState({\n      allDiarys,\n      myDiarys\n    });\n  }\n\n  async _getAllDiarys() {\n    const user = JSON.parse(window.localStorage.getItem('user'));\n    const res = await axios.get('diary', {\n      params: {\n        uid: user.id\n      }\n    });\n    this.setState({\n      allDiarys: res.data,\n      refreshing: false\n    });\n  }\n\n  render() {\n    const style = {\n      tabBox: {\n        marginTop: '1rem'\n      },\n      addButton: {\n        position: 'fixed',\n        bottom: '5rem',\n        right: '2rem',\n        opacity: '0.8'\n      }\n    };\n    const tabs = [{\n      title: '广场',\n      sub: '1'\n    }, {\n      title: '我的',\n      sub: '2'\n    }];\n    return React.createElement(\"div\", {\n      className: \"index-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, React.createElement(Header, {\n      onTabRight: this.onTabRight.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    }), React.createElement(Tabs, {\n      tabs: tabs,\n      onTabClick: this.onTabClick.bind(this),\n      renderTab: tab => React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, tab.title),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }, React.createElement(PullToRefresh, {\n      damping: 60,\n      direction: \"down\",\n      refreshing: this.state.refreshing,\n      onRefresh: () => {\n        this.setState({\n          refreshing: true\n        });\n\n        this._getAllDiarys();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: style.tabBox,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, this.state.allDiarys.length !== 0 ? React.createElement(RList, {\n      list: this.state.allDiarys,\n      onClickDiary: this.onClickDiary.bind(this),\n      onClickFavor: this.onClickFavor.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }) : React.createElement(NoData, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150\n      },\n      __self: this\n    }))), React.createElement(PullToRefresh, {\n      damping: 60,\n      direction: \"down\",\n      refreshing: this.state.refreshing,\n      onRefresh: () => {\n        this.setState({\n          refreshing: true\n        });\n\n        this._getMyDiarys();\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: style.tabBox,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    }, this.state.myDiarys.length !== 0 ? React.createElement(RList, {\n      list: this.state.myDiarys,\n      onClickDiary: this.onClickDiary.bind(this),\n      onClickFavor: this.onClickFavor.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166\n      },\n      __self: this\n    }) : React.createElement(NoData, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    })))), React.createElement(\"div\", {\n      style: style.addButton,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, React.createElement(AddButton, {\n      onClickButton: this.onClickButton.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default Index;","map":{"version":3,"sources":["/Users/hbt/MyProject/gitHub/react-diary/src/views/index.jsx"],"names":["React","Tabs","PullToRefresh","Toast","axios","Header","RList","AddButton","NoData","Index","Component","constructor","state","allDiarys","myDiarys","visible","selected","tabIndex","componentDidMount","_getAllDiarys","onClickButton","props","history","push","_getMyDiarys","user","JSON","parse","window","localStorage","getItem","setState","refreshing","res","get","params","id","start","count","data","onClickDiary","item","onClickFavor","e","stopPropagation","uid","_favor","onTabClick","tab","index","isDidMyDiary","onTabRight","storage","removeItem","diary_id","post","map","diary","isFavor","favor_nums","render","style","tabBox","marginTop","addButton","position","bottom","right","opacity","tabs","title","sub","bind","length"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Tabs, PullToRefresh, Toast } from 'antd-mobile'\nimport axios from '../utils/request'\nimport Header from '../components/Header'\nimport RList from '../components/List'\nimport AddButton from '../components/AddButton'\nimport NoData from '../components/NoData'\nimport '../styles/register.css'\n\nclass Index extends React.Component {\n  constructor() {\n    super()\n    this.state = {\n      allDiarys: [],\n      myDiarys: [],\n      visible: true,\n      selected: '',\n      tabIndex: 0\n    }\n  }\n  componentDidMount() {\n    this._getAllDiarys()\n  }\n  onClickButton() {\n    this.props.history.push('/writeDiary')\n  }\n\n  async _getMyDiarys() {\n    const user = JSON.parse(window.localStorage.getItem('user'))\n    if (!user) {\n      this.setState({\n        refreshing: false\n      })\n      return\n    }\n    const res = await axios.get('diary/myDiary', {\n      params: {\n        id: user.id,\n        start: 0,\n        count: 10\n      }\n    })\n    this.setState({\n      myDiarys: res.data,\n      refreshing: false\n    })\n  }\n  onClickDiary(item) {\n    this.props.history.push(`diaryDetail/${item.id}`)\n  }\n  onClickFavor(item, e) {\n    e.stopPropagation()\n    const { id, uid } = item\n    this._favor(id, uid)\n  }\n  onTabClick(tab, index) {\n    if (!this.isDidMyDiary && index === 1) {\n      this._getMyDiarys()\n      this.isDidMyDiary = true\n    }\n    this.setState({\n      tabIndex: index\n    })\n  }\n  onTabRight() {\n    const storage = window.localStorage\n    storage.removeItem('user')\n    this.props.history.push('/login')\n  }\n\n  async _favor(diary_id, uid) {\n    await axios.post('/favor/', {\n      diary_id,\n      uid\n    })\n    const { allDiarys, myDiarys, tabIndex } = this.state\n    if (tabIndex === 0) {\n      allDiarys.map(diary => {\n        if (diary.id === diary_id) {\n          diary.isFavor = 1\n          diary.favor_nums = diary.favor_nums + 1\n        }\n      })\n    } else {\n      myDiarys.map(diary => {\n        if (diary.id === diary_id) {\n          diary.isFavor = 1\n          diary.favor_nums = diary.favor_nums + 1\n        }\n      })\n    }\n    this.setState({\n      allDiarys,\n      myDiarys\n    })\n  }\n  async _getAllDiarys() {\n    const user = JSON.parse(window.localStorage.getItem('user'))\n    const res = await axios.get('diary', {\n      params: {\n        uid: user.id\n      }\n    })\n    this.setState({\n      allDiarys: res.data,\n      refreshing: false\n    })\n  }\n  render() {\n    const style = {\n      tabBox: {\n        marginTop: '1rem'\n      },\n      addButton: {\n        position: 'fixed',\n        bottom: '5rem',\n        right: '2rem',\n        opacity: '0.8'\n      }\n    }\n    const tabs = [\n      { title: '广场', sub: '1' },\n      { title: '我的', sub: '2' }\n    ]\n    return (\n      <div className=\"index-container\">\n        <Header onTabRight={this.onTabRight.bind(this)}></Header>\n        <Tabs\n          tabs={tabs}\n          onTabClick={this.onTabClick.bind(this)}\n          renderTab={tab => <span>{tab.title}</span>}\n        >\n          <PullToRefresh\n            damping={60}\n            direction=\"down\"\n            refreshing={this.state.refreshing}\n            onRefresh={() => {\n              this.setState({ refreshing: true })\n              this._getAllDiarys()\n            }}\n          >\n            <div style={style.tabBox}>\n              {this.state.allDiarys.length !== 0 ? (\n                <RList\n                  list={this.state.allDiarys}\n                  onClickDiary={this.onClickDiary.bind(this)}\n                  onClickFavor={this.onClickFavor.bind(this)}\n                ></RList>\n              ) : (\n                <NoData></NoData>\n              )}\n            </div>\n          </PullToRefresh>\n\n          <PullToRefresh\n            damping={60}\n            direction=\"down\"\n            refreshing={this.state.refreshing}\n            onRefresh={() => {\n              this.setState({ refreshing: true })\n              this._getMyDiarys()\n            }}\n          >\n            <div style={style.tabBox}>\n              {this.state.myDiarys.length !== 0 ? (\n                <RList\n                  list={this.state.myDiarys}\n                  onClickDiary={this.onClickDiary.bind(this)}\n                  onClickFavor={this.onClickFavor.bind(this)}\n                ></RList>\n              ) : (\n                <NoData></NoData>\n              )}\n            </div>\n          </PullToRefresh>\n        </Tabs>\n        <div style={style.addButton}>\n          <AddButton onClickButton={this.onClickButton.bind(this)}></AddButton>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default Index\n"]},"metadata":{},"sourceType":"module"}