{"ast":null,"code":"import _regeneratorRuntime from\"/Users/hbt/MyProject/gitHub/react-diary/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/hbt/MyProject/gitHub/react-diary/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/hbt/MyProject/gitHub/react-diary/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/hbt/MyProject/gitHub/react-diary/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/hbt/MyProject/gitHub/react-diary/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/hbt/MyProject/gitHub/react-diary/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/hbt/MyProject/gitHub/react-diary/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import{Tabs,PullToRefresh,Toast}from'antd-mobile';import axios from'../utils/request';import Header from'../components/Header';import RList from'../components/List';import AddButton from'../components/AddButton';import NoData from'../components/NoData';import'../styles/register.css';var Index=/*#__PURE__*/function(_React$Component){_inherits(Index,_React$Component);function Index(){var _this;_classCallCheck(this,Index);_this=_possibleConstructorReturn(this,_getPrototypeOf(Index).call(this));_this.state={allDiarys:[],myDiarys:[],visible:true,selected:'',tabIndex:0};return _this;}_createClass(Index,[{key:\"componentDidMount\",value:function componentDidMount(){this._getAllDiarys();}},{key:\"onClickButton\",value:function onClickButton(){this.props.history.push('/writeDiary');}},{key:\"_getMyDiarys\",value:function(){var _getMyDiarys2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var user,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:user=JSON.parse(window.localStorage.getItem('user'));if(user){_context.next=4;break;}this.setState({refreshing:false});return _context.abrupt(\"return\");case 4:_context.next=6;return axios.get('diary/myDiary',{params:{id:user.id,start:0,count:10}});case 6:res=_context.sent;this.setState({myDiarys:res.data,refreshing:false});case 8:case\"end\":return _context.stop();}}},_callee,this);}));function _getMyDiarys(){return _getMyDiarys2.apply(this,arguments);}return _getMyDiarys;}()},{key:\"onClickDiary\",value:function onClickDiary(item){this.props.history.push(\"diaryDetail/\".concat(item.id));}},{key:\"onClickFavor\",value:function onClickFavor(item,e){e.stopPropagation();var id=item.id,uid=item.uid;this._favor(id,uid);}},{key:\"onTabClick\",value:function onTabClick(tab,index){if(!this.isDidMyDiary&&index===1){this._getMyDiarys();this.isDidMyDiary=true;}this.setState({tabIndex:index});}},{key:\"onTabRight\",value:function onTabRight(){var storage=window.localStorage;storage.removeItem('user');this.props.history.push('/login');}},{key:\"_favor\",value:function(){var _favor2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(diary_id,uid){var _this$state,allDiarys,myDiarys,tabIndex;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post('/favor/',{diary_id:diary_id,uid:uid});case 2:_this$state=this.state,allDiarys=_this$state.allDiarys,myDiarys=_this$state.myDiarys,tabIndex=_this$state.tabIndex;if(tabIndex===0){allDiarys.map(function(diary){if(diary.id===diary_id){diary.isFavor=1;diary.favor_nums=diary.favor_nums+1;}});}else{myDiarys.map(function(diary){if(diary.id===diary_id){diary.isFavor=1;diary.favor_nums=diary.favor_nums+1;}});}this.setState({allDiarys:allDiarys,myDiarys:myDiarys});case 5:case\"end\":return _context2.stop();}}},_callee2,this);}));function _favor(_x,_x2){return _favor2.apply(this,arguments);}return _favor;}()},{key:\"_getAllDiarys\",value:function(){var _getAllDiarys2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var user,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:user=JSON.parse(window.localStorage.getItem('user'));_context3.next=3;return axios.get('diary',{params:{uid:user.id}});case 3:res=_context3.sent;this.setState({allDiarys:res.data,refreshing:false});case 5:case\"end\":return _context3.stop();}}},_callee3,this);}));function _getAllDiarys(){return _getAllDiarys2.apply(this,arguments);}return _getAllDiarys;}()},{key:\"render\",value:function render(){var _this2=this;var style={tabBox:{marginTop:'1rem'},addButton:{position:'fixed',bottom:'5rem',right:'2rem',opacity:'0.8'}};var tabs=[{title:'广场',sub:'1'},{title:'我的',sub:'2'}];return React.createElement(\"div\",{className:\"index-container\"},React.createElement(Header,{onTabRight:this.onTabRight.bind(this)}),React.createElement(Tabs,{tabs:tabs,onTabClick:this.onTabClick.bind(this),renderTab:function renderTab(tab){return React.createElement(\"span\",null,tab.title);}},React.createElement(PullToRefresh,{damping:60,direction:\"down\",refreshing:this.state.refreshing,onRefresh:function onRefresh(){_this2.setState({refreshing:true});_this2._getAllDiarys();}},React.createElement(\"div\",{style:style.tabBox},this.state.allDiarys.length!==0?React.createElement(RList,{list:this.state.allDiarys,onClickDiary:this.onClickDiary.bind(this),onClickFavor:this.onClickFavor.bind(this)}):React.createElement(NoData,null))),React.createElement(PullToRefresh,{damping:60,direction:\"down\",refreshing:this.state.refreshing,onRefresh:function onRefresh(){_this2.setState({refreshing:true});_this2._getMyDiarys();}},React.createElement(\"div\",{style:style.tabBox},this.state.myDiarys.length!==0?React.createElement(RList,{list:this.state.myDiarys,onClickDiary:this.onClickDiary.bind(this),onClickFavor:this.onClickFavor.bind(this)}):React.createElement(NoData,null)))),React.createElement(\"div\",{style:style.addButton},React.createElement(AddButton,{onClickButton:this.onClickButton.bind(this)})));}}]);return Index;}(React.Component);export default Index;","map":{"version":3,"sources":["/Users/hbt/MyProject/gitHub/react-diary/src/views/index.jsx"],"names":["React","Tabs","PullToRefresh","Toast","axios","Header","RList","AddButton","NoData","Index","state","allDiarys","myDiarys","visible","selected","tabIndex","_getAllDiarys","props","history","push","user","JSON","parse","window","localStorage","getItem","setState","refreshing","get","params","id","start","count","res","data","item","e","stopPropagation","uid","_favor","tab","index","isDidMyDiary","_getMyDiarys","storage","removeItem","diary_id","post","map","diary","isFavor","favor_nums","style","tabBox","marginTop","addButton","position","bottom","right","opacity","tabs","title","sub","onTabRight","bind","onTabClick","length","onClickDiary","onClickFavor","onClickButton","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Tabs, PullToRefresh, Toast } from 'antd-mobile'\nimport axios from '../utils/request'\nimport Header from '../components/Header'\nimport RList from '../components/List'\nimport AddButton from '../components/AddButton'\nimport NoData from '../components/NoData'\nimport '../styles/register.css'\n\nclass Index extends React.Component {\n  constructor() {\n    super()\n    this.state = {\n      allDiarys: [],\n      myDiarys: [],\n      visible: true,\n      selected: '',\n      tabIndex: 0\n    }\n  }\n  componentDidMount() {\n    this._getAllDiarys()\n  }\n  onClickButton() {\n    this.props.history.push('/writeDiary')\n  }\n\n  async _getMyDiarys() {\n    const user = JSON.parse(window.localStorage.getItem('user'))\n    if (!user) {\n      this.setState({\n        refreshing: false\n      })\n      return\n    }\n    const res = await axios.get('diary/myDiary', {\n      params: {\n        id: user.id,\n        start: 0,\n        count: 10\n      }\n    })\n    this.setState({\n      myDiarys: res.data,\n      refreshing: false\n    })\n  }\n  onClickDiary(item) {\n    this.props.history.push(`diaryDetail/${item.id}`)\n  }\n  onClickFavor(item, e) {\n    e.stopPropagation()\n    const { id, uid } = item\n    this._favor(id, uid)\n  }\n  onTabClick(tab, index) {\n    if (!this.isDidMyDiary && index === 1) {\n      this._getMyDiarys()\n      this.isDidMyDiary = true\n    }\n    this.setState({\n      tabIndex: index\n    })\n  }\n  onTabRight() {\n    const storage = window.localStorage\n    storage.removeItem('user')\n    this.props.history.push('/login')\n  }\n\n  async _favor(diary_id, uid) {\n    await axios.post('/favor/', {\n      diary_id,\n      uid\n    })\n    const { allDiarys, myDiarys, tabIndex } = this.state\n    if (tabIndex === 0) {\n      allDiarys.map(diary => {\n        if (diary.id === diary_id) {\n          diary.isFavor = 1\n          diary.favor_nums = diary.favor_nums + 1\n        }\n      })\n    } else {\n      myDiarys.map(diary => {\n        if (diary.id === diary_id) {\n          diary.isFavor = 1\n          diary.favor_nums = diary.favor_nums + 1\n        }\n      })\n    }\n    this.setState({\n      allDiarys,\n      myDiarys\n    })\n  }\n  async _getAllDiarys() {\n    const user = JSON.parse(window.localStorage.getItem('user'))\n    const res = await axios.get('diary', {\n      params: {\n        uid: user.id\n      }\n    })\n    this.setState({\n      allDiarys: res.data,\n      refreshing: false\n    })\n  }\n  render() {\n    const style = {\n      tabBox: {\n        marginTop: '1rem'\n      },\n      addButton: {\n        position: 'fixed',\n        bottom: '5rem',\n        right: '2rem',\n        opacity: '0.8'\n      }\n    }\n    const tabs = [\n      { title: '广场', sub: '1' },\n      { title: '我的', sub: '2' }\n    ]\n    return (\n      <div className=\"index-container\">\n        <Header onTabRight={this.onTabRight.bind(this)}></Header>\n        <Tabs\n          tabs={tabs}\n          onTabClick={this.onTabClick.bind(this)}\n          renderTab={tab => <span>{tab.title}</span>}\n        >\n          <PullToRefresh\n            damping={60}\n            direction=\"down\"\n            refreshing={this.state.refreshing}\n            onRefresh={() => {\n              this.setState({ refreshing: true })\n              this._getAllDiarys()\n            }}\n          >\n            <div style={style.tabBox}>\n              {this.state.allDiarys.length !== 0 ? (\n                <RList\n                  list={this.state.allDiarys}\n                  onClickDiary={this.onClickDiary.bind(this)}\n                  onClickFavor={this.onClickFavor.bind(this)}\n                ></RList>\n              ) : (\n                <NoData></NoData>\n              )}\n            </div>\n          </PullToRefresh>\n\n          <PullToRefresh\n            damping={60}\n            direction=\"down\"\n            refreshing={this.state.refreshing}\n            onRefresh={() => {\n              this.setState({ refreshing: true })\n              this._getMyDiarys()\n            }}\n          >\n            <div style={style.tabBox}>\n              {this.state.myDiarys.length !== 0 ? (\n                <RList\n                  list={this.state.myDiarys}\n                  onClickDiary={this.onClickDiary.bind(this)}\n                  onClickFavor={this.onClickFavor.bind(this)}\n                ></RList>\n              ) : (\n                <NoData></NoData>\n              )}\n            </div>\n          </PullToRefresh>\n        </Tabs>\n        <div style={style.addButton}>\n          <AddButton onClickButton={this.onClickButton.bind(this)}></AddButton>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default Index\n"]},"metadata":{},"sourceType":"module"}